<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8">
    <!-- スマホで見やすくする設定 -->
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" type="text/css" href="list_stylesheet.css">
    
    <!-- ブラウザのタブに表示されるタイトル -->
    <title>みんなの投稿</title>
    <ul class="mypage-post-tab">
      <li class="js-mypage-tab">
        <img src="img/icon/login.png" class="mypage-tab-img">
      </li>
      <li class="js-mypage-tab">
        <img src="img/icon/go_sum.png" class="mypage-tab-img">
      </li>
      <li class="js-mypage-tab-me">
        <img src="img/icon/dis.png" class="mypage-tab-img">
      </li>
      <li class="js-mypage-tab-stock">
        <img src="img/icon/tab.png" class="mypage-tab-img">
      </li>
    </ul>
 </head>
 
<body>
    <ul id="list" class="photo-list">
    </ul>
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    
    
    
    <script>
        $.urlParam = function(name){
            var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
            if (results==null){
               return null;
            }
            else{
               return decodeURI(results[1]) || 0;
            }
        }
        var post_id = $.urlParam('post_id');
        
    // 　　現在地取得
             // Geolocation APIに対応している
        if (navigator.geolocation) {
          alert("この端末では位置情報が取得できます");
        // Geolocation APIに対応していない
        } else {
          alert("この端末では位置情報が取得できません");
        }
        
            // 現在地取得処理
        function getPosition() {
          // 現在地を取得
          navigator.geolocation.getCurrentPosition(
            // 取得成功した場合
            function(position) {
                alert("緯度:"+position.coords.latitude+",経度"+position.coords.longitude);
                $.ajax({
                        url: "/instaglam/api/get_image_db.php?user_post="+position.coords.latitude+ "%20"+position.coords.longitude,
                        dataType: "json"
                    }).done(function(data) {
            			for (var i = 0, len = data.length; i< len; ++i){
                        console.log(data[i]);}
                        
                        for(var i = 0, len = data.length; i< len; ++i) {
                          var article = "<li>\
                                         <a  href='/instaglam/detail_screen.html?post_id="+ data[i].post_id + "' style='background-image:url(" + data[i].img_url + ")'  class='photo-list-img' ></a>\
                                         </li>";
                            $("#list").append(article);
                        }
                })
                
            },
            // 取得失敗した場合
            function(error) {
              switch(error.code) {
                case 1: //PERMISSION_DENIED
                  alert("位置情報の利用が許可されていません");
                  break;
                case 2: //POSITION_UNAVAILABLE
                  alert("現在位置が取得できませんでした");
                  break;
                case 3: //TIMEOUT
                  alert("タイムアウトになりました");
                  break;
                default:
                  alert("その他のエラー(エラーコード:"+error.code+")");
                  break;
              }
            }
          );
        }
        
        getPosition();
        
    </script>
</body>
</html>